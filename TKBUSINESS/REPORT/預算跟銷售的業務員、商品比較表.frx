<?xml version="1.0" encoding="utf-8"?>
<Report ScriptLanguage="CSharp" ReportInfo.Created="05/07/2021 15:43:42" ReportInfo.Modified="05/07/2021 16:08:55" ReportInfo.CreatorVersion="2016.4.4.0">
  <Dictionary>
    <MsSqlDataConnection Name="Connection" ConnectionString="rijcmlqHwzMSgwTFaHpjtG3vsOj8Zy6q+uhwpDsytgWqwZQZyEQUQyQ022aWUGqU90pHzzNjHuzu89K+RQ2LIBVx1fpgNkNJhwC4eetn2/Uy0fMrO7zDUE5AmRb+0bcYI+lxqpNK7VAg28EMb2zujBtCWMs8uR7KE3TT1XHtlPqNg0WX9LimDCfY5iH8J5+HeWaKZTw">
      <TableDataSource Name="Table" DataType="System.Int32" Enabled="true" SelectCommand="DECLARE @THISYEARS nvarchar(10)&#13;&#10;DECLARE @LASTYEARS nvarchar(10)&#13;&#10;DECLARE @MONTHS nvarchar(10)&#13;&#10;SET @THISYEARS='2021'&#13;&#10;SET @LASTYEARS='2020'&#13;&#10;SET @MONTHS=''&#13;&#10;&#13;&#10;SELECT ID3 AS '業務員代',MV002 AS '業務員',@THISYEARS AS '年度'&#13;&#10;,SUM(PRE202101+PRE202102+PRE202103+PRE202104+PRE202105+PRE202106+PRE202107+PRE202108+PRE202109+PRE202110+PRE202111+PRE202112)  AS '年度預算'&#13;&#10;,SUM((IN202101-OUT202101)+(IN202102-OUT202102)+(IN202103-OUT202103)+(IN202104-OUT202104)+(IN202105-OUT202105)+(IN202106-OUT202106)+(IN202107-OUT202107)+(IN202108-OUT202108)+(IN202109-OUT202109)+(IN202110-OUT202110)+(IN202111-OUT202111)+(IN202112-OUT202112)) AS '本年銷售金額'&#13;&#10;,((SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG023='Y' AND TG001 NOT IN ('A233','A234') AND TG006=ID3 AND TG003 LIKE @LASTYEARS+'%')-(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI019='Y' AND TI001 NOT IN ('A243','A246') AND TI006=ID3 AND TI003 LIKE @LASTYEARS+'%')) AS '去年銷售金額'&#13;&#10;,(SUM((IN202101-OUT202101)+(IN202102-OUT202102)+(IN202103-OUT202103)+(IN202104-OUT202104)+(IN202105-OUT202105)+(IN202106-OUT202106)+(IN202107-OUT202107)+(IN202108-OUT202108)+(IN202109-OUT202109)+(IN202110-OUT202110)+(IN202111-OUT202111)+(IN202112-OUT202112)))/(SUM(PRE202101+PRE202102+PRE202103+PRE202104+PRE202105+PRE202106+PRE202107+PRE202108+PRE202109+PRE202110+PRE202111+PRE202112)) AS '預算累積達成率'&#13;&#10;FROM(&#13;&#10;SELECT ID1,MA002,ID3,MV002&#13;&#10;,(SELECT ISNULL(SUM(MN005),0) FROM [TK].dbo.COPMM,[TK].dbo.COPMN WHERE MM001=MN001 AND MM002=MN002 AND MM003=ID1 AND MM001=@THISYEARS AND MN003='01') AS 'PRE202101'&#13;&#10;,(SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG004=ID1 AND TG023='Y' AND TG001 NOT IN ('A233','A234') AND TG003 LIKE '202101%') 'IN202101'&#13;&#10;,(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI004=ID1 AND TI019='Y' AND TI001 NOT IN ('A243','A246') AND TI003 LIKE '202101%') 'OUT202101'&#13;&#10;,(SELECT ISNULL(SUM(MN005),0) FROM [TK].dbo.COPMM,[TK].dbo.COPMN WHERE MM001=MN001 AND MM002=MN002 AND MM003=ID1 AND MM001=@THISYEARS AND MN003='02') AS 'PRE202102'&#13;&#10;,(SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG004=ID1 AND TG023='Y' AND TG001 NOT IN ('A233','A234') AND TG003 LIKE '202102%') 'IN202102'&#13;&#10;,(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI004=ID1 AND TI019='Y' AND TI001 NOT IN ('A243','A246') AND TI003 LIKE '202102%') 'OUT202102'&#13;&#10;,(SELECT ISNULL(SUM(MN005),0) FROM [TK].dbo.COPMM,[TK].dbo.COPMN WHERE MM001=MN001 AND MM002=MN002 AND MM003=ID1 AND MM001=@THISYEARS AND MN003='03') AS 'PRE202103'&#13;&#10;,(SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG004=ID1 AND TG023='Y' AND TG001 NOT IN ('A233','A234') AND TG003 LIKE '202103%') 'IN202103'&#13;&#10;,(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI004=ID1 AND TI019='Y' AND TI001 NOT IN ('A243','A246') AND TI003 LIKE '202103%') 'OUT202103'&#13;&#10;,(SELECT ISNULL(SUM(MN005),0) FROM [TK].dbo.COPMM,[TK].dbo.COPMN WHERE MM001=MN001 AND MM002=MN002 AND MM003=ID1 AND MM001=@THISYEARS AND MN003='04') AS 'PRE202104'&#13;&#10;,(SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG004=ID1 AND TG023='Y' AND TG001 NOT IN ('A233','A234') AND TG003 LIKE '202104%') 'IN202104'&#13;&#10;,(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI004=ID1 AND TI019='Y' AND TI001 NOT IN ('A243','A246') AND TI003 LIKE '202104%') 'OUT202104'&#13;&#10;,(SELECT ISNULL(SUM(MN005),0) FROM [TK].dbo.COPMM,[TK].dbo.COPMN WHERE MM001=MN001 AND MM002=MN002 AND MM003=ID1 AND MM001=@THISYEARS AND MN003='05') AS 'PRE202105'&#13;&#10;,(SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG004=ID1 AND TG023='Y' AND TG001 NOT IN ('A233','A234') AND TG003 LIKE '202105%') 'IN202105'&#13;&#10;,(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI004=ID1 AND TI019='Y' AND TI001 NOT IN ('A243','A246') AND TI003 LIKE '202105%') 'OUT202105'&#13;&#10;,(SELECT ISNULL(SUM(MN005),0) FROM [TK].dbo.COPMM,[TK].dbo.COPMN WHERE MM001=MN001 AND MM002=MN002 AND MM003=ID1 AND MM001=@THISYEARS AND MN003='06') AS 'PRE202106'&#13;&#10;,(SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG004=ID1 AND TG023='Y' AND TG001 NOT IN ('A233','A234') AND TG003 LIKE '202106%') 'IN202106'&#13;&#10;,(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI004=ID1 AND TI019='Y' AND TI001 NOT IN ('A243','A246') AND TI003 LIKE '202106%') 'OUT202106'&#13;&#10;,(SELECT ISNULL(SUM(MN005),0) FROM [TK].dbo.COPMM,[TK].dbo.COPMN WHERE MM001=MN001 AND MM002=MN002 AND MM003=ID1 AND MM001=@THISYEARS AND MN003='07') AS 'PRE202107'&#13;&#10;,(SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG004=ID1 AND TG023='Y' AND TG001 NOT IN ('A233','A234') AND TG003 LIKE '202107%') 'IN202107'&#13;&#10;,(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI004=ID1 AND TI019='Y' AND TI001 NOT IN ('A243','A246') AND TI003 LIKE '202107%') 'OUT202107'&#13;&#10;,(SELECT ISNULL(SUM(MN005),0) FROM [TK].dbo.COPMM,[TK].dbo.COPMN WHERE MM001=MN001 AND MM002=MN002 AND MM003=ID1 AND MM001=@THISYEARS AND MN003='08') AS 'PRE202108'&#13;&#10;,(SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG004=ID1 AND TG023='Y' AND TG001 NOT IN ('A233','A234') AND TG003 LIKE '202108%') 'IN202108'&#13;&#10;,(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI004=ID1 AND TI019='Y' AND TI001 NOT IN ('A243','A246') AND TI003 LIKE '202108%') 'OUT202108'&#13;&#10;,(SELECT ISNULL(SUM(MN005),0) FROM [TK].dbo.COPMM,[TK].dbo.COPMN WHERE MM001=MN001 AND MM002=MN002 AND MM003=ID1 AND MM001=@THISYEARS AND MN003='09') AS 'PRE202109'&#13;&#10;,(SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG004=ID1 AND TG023='Y' AND TG001 NOT IN ('A233','A234') AND TG003 LIKE '202109%') 'IN202109'&#13;&#10;,(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI004=ID1 AND TI019='Y' AND TI001 NOT IN ('A243','A246') AND TI003 LIKE '202109%') 'OUT202109'&#13;&#10;,(SELECT ISNULL(SUM(MN005),0) FROM [TK].dbo.COPMM,[TK].dbo.COPMN WHERE MM001=MN001 AND MM002=MN002 AND MM003=ID1 AND MM001=@THISYEARS AND MN003='10') AS 'PRE202110'&#13;&#10;,(SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG004=ID1 AND TG023='Y' AND TG001 NOT IN ('A233','A234') AND TG003 LIKE '202110%') 'IN202110'&#13;&#10;,(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI004=ID1 AND TI019='Y' AND TI001 NOT IN ('A243','A246') AND TI003 LIKE '202110%') 'OUT202110'&#13;&#10;,(SELECT ISNULL(SUM(MN005),0) FROM [TK].dbo.COPMM,[TK].dbo.COPMN WHERE MM001=MN001 AND MM002=MN002 AND MM003=ID1 AND MM001=@THISYEARS AND MN003='11') AS 'PRE202111'&#13;&#10;,(SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG004=ID1 AND TG023='Y' AND TG001 NOT IN ('A233','A234') AND TG003 LIKE '20211%') 'IN202111'&#13;&#10;,(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI004=ID1 AND TI019='Y' AND TI001 NOT IN ('A243','A246') AND TI003 LIKE '20211%') 'OUT202111'&#13;&#10;,(SELECT ISNULL(SUM(MN005),0) FROM [TK].dbo.COPMM,[TK].dbo.COPMN WHERE MM001=MN001 AND MM002=MN002 AND MM003=ID1 AND MM001=@THISYEARS AND MN003='12') AS 'PRE202112'&#13;&#10;,(SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG004=ID1 AND TG023='Y' AND TG001 NOT IN ('A233','A234') AND TG003 LIKE '202112%') 'IN202112'&#13;&#10;,(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI004=ID1 AND TI019='Y' AND TI001 NOT IN ('A243','A246') AND TI003 LIKE '202112%') 'OUT202112'&#13;&#10;&#13;&#10;&#13;&#10;FROM [TK].dbo.ZSLAES&#13;&#10;LEFT JOIN [TK].dbo.CMSMV ON MV001=ID3&#13;&#10;LEFT JOIN [TK].dbo.COPMA ON MA001=ID1&#13;&#10;WHERE YEARS=@THISYEARS&#13;&#10;) AS TEMP&#13;&#10;GROUP BY ID3,MV002&#13;&#10;UNION ALL&#13;&#10;SELECT MM003,MA002,MN001,SUM(MN005) AS 'PRE'&#13;&#10;,((SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG023='Y' AND TG001 IN ('A233','A234') AND TG003 LIKE MN001+'%')-(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI019='Y' AND TI001 IN ('A243','A246') AND TI003 LIKE MN001+'%')) '2021'&#13;&#10;,((SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG023='Y' AND TG001 IN ('A233','A234') AND TG003 LIKE '2020%')-(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI019='Y' AND TI001 IN ('A243','A246') AND TI003 LIKE '2020%'))AS '電商去年實收'&#13;&#10;,((SELECT ISNULL(SUM(TH037),0) FROM [TK].dbo.COPTG,[TK].dbo.COPTH WHERE TG001=TH001 AND TG002=TH002 AND TG023='Y' AND TG001 IN ('A233','A234') AND TG003 LIKE MN001+'%')-(SELECT ISNULL(SUM(TJ033),0) FROM [TK].dbo.COPTI,[TK].dbo.COPTJ WHERE TI001=TJ001 AND TI002=TJ002 AND TI019='Y' AND TI001 IN ('A243','A246') AND TI003 LIKE MN001+'%'))/(SUM(MN005))  AS '預算累積達成率'&#13;&#10;FROM [TK].dbo.COPMM,[TK].dbo.COPMN,[TK].dbo.COPMA &#13;&#10;WHERE MM001=MN001 AND MM002=MN002 &#13;&#10;AND MA001=MM003&#13;&#10;AND MM001='2021'&#13;&#10;AND MM003='44900001'&#13;&#10;GROUP BY MM003,MA002,MN001&#13;&#10;">
        <Column Name="業務員代" DataType="System.String"/>
        <Column Name="業務員" DataType="System.String"/>
        <Column Name="年度" DataType="System.String"/>
        <Column Name="年度預算" DataType="System.Decimal"/>
        <Column Name="本年銷售金額" DataType="System.Decimal"/>
        <Column Name="去年銷售金額" DataType="System.Decimal"/>
        <Column Name="預算累積達成率" DataType="System.Decimal"/>
      </TableDataSource>
    </MsSqlDataConnection>
  </Dictionary>
  <ReportPage Name="Page1" Landscape="true" PaperWidth="297" PaperHeight="210">
    <ReportTitleBand Name="ReportTitle1" Width="1047.06" Height="18.9">
      <TextObject Name="Text1" Width="661.5" Height="18.9" Text="預算跟銷售的業務員、商品比較表" HorzAlign="Center" VertAlign="Center"/>
    </ReportTitleBand>
    <PageHeaderBand Name="PageHeader1" Top="23.39" Width="1047.06" Height="18.9">
      <TextObject Name="Text3" Width="94.5" Height="18.9" Border.Lines="All" Text="年度" HorzAlign="Center" VertAlign="Center"/>
      <TextObject Name="Text5" Left="94.5" Width="94.5" Height="18.9" Border.Lines="All" Text="業務員代" HorzAlign="Center" VertAlign="Center"/>
      <TextObject Name="Text7" Left="189" Width="94.5" Height="18.9" Border.Lines="All" Text="業務員" HorzAlign="Center" VertAlign="Center"/>
      <TextObject Name="Text9" Left="283.5" Width="94.5" Height="18.9" Border.Lines="All" Text="年度預算" HorzAlign="Center" VertAlign="Center"/>
      <TextObject Name="Text11" Left="378" Width="94.5" Height="18.9" Border.Lines="All" Text="本年銷售金額" HorzAlign="Center" VertAlign="Center"/>
      <TextObject Name="Text13" Left="472.5" Width="94.5" Height="18.9" Border.Lines="All" Text="去年銷售金額" HorzAlign="Center" VertAlign="Center"/>
      <TextObject Name="Text15" Left="567" Width="94.5" Height="18.9" Border.Lines="All" Text="預算累積達成率" HorzAlign="Center" VertAlign="Center"/>
    </PageHeaderBand>
    <DataBand Name="Data1" Top="46.79" Width="1047.06" Height="18.9" DataSource="Table">
      <TextObject Name="Text2" Width="94.5" Height="18.9" Border.Lines="All" Text="[Table.年度]" HorzAlign="Center" VertAlign="Center"/>
      <TextObject Name="Text4" Left="94.5" Width="94.5" Height="18.9" Border.Lines="All" Text="[Table.業務員代]" HorzAlign="Center" VertAlign="Center"/>
      <TextObject Name="Text6" Left="189" Width="94.5" Height="18.9" Border.Lines="All" Text="[Table.業務員]" HorzAlign="Center" VertAlign="Center"/>
      <TextObject Name="Text8" Left="283.5" Width="94.5" Height="18.9" Border.Lines="All" Text="[Table.年度預算]" Format="Number" Format.UseLocale="false" Format.DecimalDigits="0" Format.DecimalSeparator="." Format.GroupSeparator="," Format.NegativePattern="1" HorzAlign="Right" VertAlign="Center" WordWrap="false" Trimming="EllipsisCharacter"/>
      <TextObject Name="Text10" Left="378" Width="94.5" Height="18.9" Border.Lines="All" Text="[Table.本年銷售金額]" Format="Number" Format.UseLocale="false" Format.DecimalDigits="0" Format.DecimalSeparator="." Format.GroupSeparator="," Format.NegativePattern="1" HorzAlign="Right" VertAlign="Center" WordWrap="false" Trimming="EllipsisCharacter"/>
      <TextObject Name="Text12" Left="472.5" Width="94.5" Height="18.9" Border.Lines="All" Text="[Table.去年銷售金額]" Format="Number" Format.UseLocale="false" Format.DecimalDigits="0" Format.DecimalSeparator="." Format.GroupSeparator="," Format.NegativePattern="1" HorzAlign="Right" VertAlign="Center" WordWrap="false" Trimming="EllipsisCharacter"/>
      <TextObject Name="Text14" Left="567" Width="94.5" Height="18.9" Border.Lines="All" Text="[Table.預算累積達成率]" Format="Percent" Format.UseLocale="true" HorzAlign="Right" VertAlign="Center" WordWrap="false" Trimming="EllipsisCharacter"/>
    </DataBand>
    <PageFooterBand Name="PageFooter1" Top="70.18" Width="1047.06" Height="18.9"/>
  </ReportPage>
</Report>
